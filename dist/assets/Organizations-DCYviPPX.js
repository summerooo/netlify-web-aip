import{y as G,r as d,l as H,h as K,z as v,A as f,R as t,J as l,al as s,B as a,O as r,u as p,Q as X,a6 as Y,P as g,I as Z,L as h,W as ee}from"./vendor-D5A_PLSQ.js";import{E as w,p as te,j as le,o as N,w as oe,k as ae,n as ne}from"./ui-DUo8Dfqk.js";import{g as se,c as ie,d as re}from"./organizations-DV3rHeUx.js";import{u as de}from"./index-1yu-MD6X.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./supabase-C1h6x9Gt.js";const me={class:"organizations"},fe={class:"header-right"},pe={key:0,class:"loading-container"},_e={key:1,class:"empty-state"},ce={key:2,class:"organizations-grid"},ve={class:"org-header"},ge={class:"org-avatar"},ye={class:"org-info"},we={key:0,class:"org-actions"},ke={class:"org-stats"},Ce={class:"stat-item"},Ve={class:"stat-number"},be={class:"stat-item"},ze={class:"stat-number"},xe={class:"org-footer"},De={class:"delete-dialog-content"},Oe={class:"delete-message"},$e=G({__name:"Organizations",setup(Fe){de();const C=d(!1),V=d(!1),b=d(!1),_=d(!1),y=d(!1),z=d([]),k=d(),c=d(null),i=H({name:"",description:""}),U={name:[{required:!0,message:"请输入组织名称",trigger:"blur"},{min:2,max:50,message:"组织名称长度在 2 到 50 个字符",trigger:"blur"}]},A=n=>new Date(n).toLocaleDateString("zh-CN"),R=n=>n.userRole==="admin",x=async()=>{C.value=!0;try{const n=await se();z.value=n}catch(n){w.error("加载组织列表失败: "+n.message)}finally{C.value=!1}},E=async()=>{k.value&&await k.value.validate(async n=>{if(n){V.value=!0;try{await ie(i.name,i.description),w.success("组织创建成功"),_.value=!1,D(),x()}catch(e){w.error("创建组织失败: "+e.message)}finally{V.value=!1}}})},D=()=>{var n;i.name="",i.description="",(n=k.value)==null||n.resetFields()},L=(n,e)=>{n==="delete"&&(c.value=e,y.value=!0)},M=async()=>{if(c.value){b.value=!0;try{await re(c.value.id),w.success("组织删除成功"),y.value=!1,c.value=null,x()}catch(n){w.error("删除组织失败: "+n.message)}finally{b.value=!1}}};return K(()=>{x()}),(n,e)=>{const u=s("el-icon"),m=s("el-button"),S=s("el-header"),j=s("el-dropdown-item"),I=s("el-dropdown-menu"),T=s("el-dropdown"),q=s("el-tag"),J=s("el-card"),P=s("el-main"),Q=s("el-container"),O=s("el-input"),$=s("el-form-item"),W=s("el-form"),F=s("el-dialog");return f(),v("div",me,[t(Q,null,{default:l(()=>[t(S,{class:"header"},{default:l(()=>[e[11]||(e[11]=a("div",{class:"header-left"},[a("h1",null,"组织管理")],-1)),a("div",fe,[t(m,{type:"primary",onClick:e[0]||(e[0]=o=>_.value=!0)},{default:l(()=>[t(u,null,{default:l(()=>[t(p(te))]),_:1}),e[10]||(e[10]=r(" 创建组织 ",-1))]),_:1})])]),_:1}),t(P,{class:"main-content"},{default:l(()=>[C.value?(f(),v("div",pe,[t(u,{class:"is-loading"},{default:l(()=>[t(p(le))]),_:1})])):z.value.length===0?(f(),v("div",_e,[t(u,null,{default:l(()=>[t(p(N))]),_:1}),e[13]||(e[13]=a("h3",null,"暂无组织",-1)),e[14]||(e[14]=a("p",null,"创建您的第一个组织来开始项目管理",-1)),t(m,{type:"primary",onClick:e[1]||(e[1]=o=>_.value=!0)},{default:l(()=>[...e[12]||(e[12]=[r(" 创建组织 ",-1)])]),_:1})])):(f(),v("div",ce,[(f(!0),v(X,null,Y(z.value,o=>(f(),Z(J,{key:o.id,class:"org-card",onClick:B=>n.$router.push(`/organizations/${o.id}`)},{default:l(()=>[a("div",ve,[a("div",ge,[t(u,null,{default:l(()=>[t(p(N))]),_:1})]),a("div",ye,[a("h3",null,g(o.name),1),a("p",null,g(o.description||"暂无描述"),1)]),R(o)?(f(),v("div",we,[t(T,{onCommand:B=>L(B,o),trigger:"click"},{dropdown:l(()=>[t(I,null,{default:l(()=>[t(j,{command:"delete",class:"delete-item"},{default:l(()=>[t(u,null,{default:l(()=>[t(p(ne))]),_:1}),e[15]||(e[15]=r(" 删除组织 ",-1))]),_:1})]),_:1})]),default:l(()=>[t(m,{type:"text",size:"small",onClick:e[2]||(e[2]=ee(()=>{},["stop"])),class:"action-btn"},{default:l(()=>[t(u,null,{default:l(()=>[t(p(ae))]),_:1})]),_:1})]),_:1},8,["onCommand"])])):h("",!0)]),a("div",ke,[a("div",Ce,[a("span",Ve,g(o.project_count||0),1),e[16]||(e[16]=a("span",{class:"stat-label"},"项目",-1))]),a("div",be,[a("span",ze,g(o.member_count||0),1),e[17]||(e[17]=a("span",{class:"stat-label"},"成员",-1))])]),a("div",xe,[t(q,{size:"small",type:"info"},{default:l(()=>[r(" 创建于 "+g(A(o.created_at)),1)]),_:2},1024)])]),_:2},1032,["onClick"]))),128))]))]),_:1})]),_:1}),t(F,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=o=>_.value=o),title:"创建组织",width:"500px",onClose:D},{footer:l(()=>[t(m,{onClick:e[5]||(e[5]=o=>_.value=!1)},{default:l(()=>[...e[18]||(e[18]=[r("取消",-1)])]),_:1}),t(m,{type:"primary",loading:V.value,onClick:E},{default:l(()=>[...e[19]||(e[19]=[r(" 创建 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(W,{ref_key:"createFormRef",ref:k,model:i,rules:U,"label-width":"80px"},{default:l(()=>[t($,{label:"组织名称",prop:"name"},{default:l(()=>[t(O,{modelValue:i.name,"onUpdate:modelValue":e[3]||(e[3]=o=>i.name=o),placeholder:"请输入组织名称"},null,8,["modelValue"])]),_:1}),t($,{label:"组织描述",prop:"description"},{default:l(()=>[t(O,{modelValue:i.description,"onUpdate:modelValue":e[4]||(e[4]=o=>i.description=o),type:"textarea",rows:3,placeholder:"请输入组织描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(F,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=o=>y.value=o),title:"删除组织",width:"400px",onClose:e[9]||(e[9]=o=>c.value=null)},{footer:l(()=>[t(m,{onClick:e[7]||(e[7]=o=>y.value=!1)},{default:l(()=>[...e[23]||(e[23]=[r("取消",-1)])]),_:1}),t(m,{type:"danger",loading:b.value,onClick:M},{default:l(()=>[...e[24]||(e[24]=[r(" 确认删除 ",-1)])]),_:1},8,["loading"])]),default:l(()=>{var o;return[a("div",De,[t(u,{class:"warning-icon"},{default:l(()=>[t(p(oe))]),_:1}),a("div",Oe,[e[21]||(e[21]=a("h4",null,"确认删除组织？",-1)),a("p",null,[e[20]||(e[20]=r("您即将删除组织 ",-1)),a("strong",null,g((o=c.value)==null?void 0:o.name),1)]),e[22]||(e[22]=a("p",{class:"warning-text"},"此操作将永久删除该组织及其所有相关数据，包括项目、任务等，且无法恢复。",-1))])])]}),_:1},8,["modelValue"])])}}}),Le=ue($e,[["__scopeId","data-v-ca31bf3a"]]);export{Le as default};
