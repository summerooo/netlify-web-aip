import{y as C,r as s,h as B,aC as M,z as d,A as g,B as a,P as u,O as h,aB as $}from"./vendor-D5A_PLSQ.js";import{f as q,h as w}from"./organizations-DV3rHeUx.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-1yu-MD6X.js";import"./supabase-C1h6x9Gt.js";import"./ui-DUo8Dfqk.js";const R={class:"accept-invitation-container"},T={class:"invitation-card"},A={key:0,class:"loading-state"},D={key:1,class:"error-state"},E={key:2,class:"success-state"},P={key:3,class:"invitation-details"},J={class:"action-buttons"},V=["disabled"],L=["disabled"],U=C({__name:"AcceptOrganizationInvitation",setup(j){const m=M(),_=$(),p=s(!0),c=s(!1),y=s(!1),f=s(!1),r=s(""),o=s(""),t=s(""),v=s("加载中..."),b=s(""),k=s("member");B(async()=>{var l;if(console.log("当前 URL:",window.location.href),console.log("route.query:",m.query),console.log("route.fullPath:",m.fullPath),o.value=m.query.token,t.value=m.query.organizationId,!o.value||!t.value){const e=localStorage.getItem("org_invitation_params");if(e)try{const n=JSON.parse(e);!o.value&&n.token&&(o.value=n.token),!t.value&&n.organizationId&&(t.value=n.organizationId),console.log("从 localStorage 恢复参数:",n)}catch(n){console.error("解析 localStorage 参数失败:",n)}}else localStorage.setItem("org_invitation_params",JSON.stringify({token:o.value,organizationId:t.value}));if(!o.value||!t.value){f.value=!0,r.value=`无效的邀请链接，缺少必要参数。当前参数: token=${o.value||"空"}, organizationId=${t.value||"空"}`,p.value=!1;return}try{console.log("正在查询邀请详情，token:",o.value);const e=await q(o.value);console.log("邀请详情查询成功:",e),v.value=e.organizationName,b.value=e.inviterEmail,k.value=e.role||"member",p.value=!1,localStorage.removeItem("org_invitation_params")}catch(e){console.error("获取邀请详情失败:",e),console.error("查询的 token:",o.value),console.error("查询的 organizationId:",t.value),f.value=!0,r.value=`无法验证邀请信息，可能已过期或无效。Token: ${(l=o.value)==null?void 0:l.substring(0,8)}...`,p.value=!1}});const O=async()=>{var l,e,n,z;c.value=!0;try{const i=await w(o.value,t.value);y.value=!0,i.alreadyMember&&(v.value=v.value||"该组织")}catch(i){console.error("接受邀请失败:",i),f.value=!0,(l=i.message)!=null&&l.includes("邀请已过期")?r.value="邀请链接已过期，请联系邀请人重新发送邀请":(e=i.message)!=null&&e.includes("邮箱")&&((n=i.message)!=null&&n.includes("不匹配"))?r.value="邀请邮箱与当前登录账号不匹配，请使用正确的账号登录":(z=i.message)!=null&&z.includes("未登录")?r.value="请先登录后再接受邀请":r.value=`接受邀请失败：${i.message||"请稍后再试"}`}finally{c.value=!1}},S=l=>({admin:"管理员",member:"成员"})[l]||l,N=()=>{_.push(`/organizations/${t.value}`)},I=()=>{_.push("/dashboard")};return(l,e)=>(g(),d("div",R,[a("div",T,[p.value?(g(),d("div",A,[...e[0]||(e[0]=[a("div",{class:"spinner"},null,-1),a("p",null,"正在验证邀请...",-1)])])):f.value?(g(),d("div",D,[e[1]||(e[1]=a("h2",null,"邀请验证失败",-1)),a("p",null,u(r.value),1),a("button",{onClick:I,class:"primary-button"},"返回首页")])):y.value?(g(),d("div",E,[e[3]||(e[3]=a("h2",null,"邀请已接受",-1)),a("p",null,[e[2]||(e[2]=h("您已成功加入组织 ",-1)),a("strong",null,u(v.value),1)]),a("button",{onClick:N,class:"primary-button"},"查看组织")])):(g(),d("div",P,[e[5]||(e[5]=a("h2",null,"组织邀请",-1)),a("p",null,[e[4]||(e[4]=h("您被邀请加入组织 ",-1)),a("strong",null,u(v.value),1)]),a("p",null,"邀请人: "+u(b.value),1),a("p",null,"您的角色: "+u(S(k.value)),1),a("div",J,[a("button",{onClick:O,class:"primary-button",disabled:c.value},u(c.value?"处理中...":"接受邀请"),9,V),a("button",{onClick:I,class:"secondary-button",disabled:c.value},"拒绝",8,L)])]))])]))}}),X=x(U,[["__scopeId","data-v-7fcb1c7d"]]);export{X as default};
