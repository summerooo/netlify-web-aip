import{y as le,r as m,l as se,c as N,h as oe,z as V,A as p,B as a,R as t,J as l,al as i,I as S,L as ne,P as d,Q as $,a6 as O,O as y,u as _,aB as re,W as ie}from"./vendor-D5A_PLSQ.js";import{E as U,p as de,f as ue,j as ce,r as _e,u as me,t as pe,v as ve,k as fe,x as ge,y as be,o as he}from"./ui-DUo8Dfqk.js";import{u as ye}from"./index-1yu-MD6X.js";import{a as we}from"./projects-C6oOc8Q2.js";import{g as Ve}from"./organizations-DV3rHeUx.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./supabase-C1h6x9Gt.js";const Ce={class:"projects-page"},ze={class:"page-header"},xe={class:"header-actions"},je={class:"page-content"},Pe={class:"stats-section"},Ue={class:"stat-content"},Me={class:"stat-icon total"},De={class:"stat-info"},Re={class:"stat-number"},Se={class:"stat-content"},Be={class:"stat-icon active"},Fe={class:"stat-info"},Le={class:"stat-number"},Ne={class:"stat-content"},$e={class:"stat-icon completed"},Oe={class:"stat-info"},qe={class:"stat-number"},Te={class:"stat-content"},Ee={class:"stat-icon managed"},Ie={class:"stat-info"},Ae={class:"stat-number"},Qe={class:"filter-section"},Je={class:"filter-left"},We={class:"filter-right"},Ge={class:"projects-section"},He={key:0,class:"loading-state"},Ke={key:1,class:"empty-state"},Xe={key:2,class:"projects-grid"},Ye={class:"project-header"},Ze={class:"project-title"},et={class:"project-actions"},tt={class:"project-description"},at={class:"project-meta"},lt={class:"meta-item"},st={class:"meta-item"},ot={class:"project-stats"},nt={class:"stat-item"},rt={class:"stat-number"},it={class:"stat-item"},dt={class:"stat-number"},ut={class:"stat-item"},ct={class:"stat-number"},_t={class:"project-footer"},mt={class:"project-role"},pt=le({__name:"Projects",setup(vt){const q=re();ye();const M=m(!0),k=m(!1),w=m(!1),g=m(""),b=m(""),v=m(""),f=m([]),C=m([]),D=m(null),r=se({name:"",description:"",organization_id:"",status:"计划中"}),T={name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:1,max:50,message:"项目名称长度在 1 到 50 个字符",trigger:"blur"}],organization_id:[{required:!0,message:"请选择所属组织",trigger:"change"}],status:[{required:!0,message:"请选择项目状态",trigger:"change"}]},z=N(()=>{const s=f.value.length,e=f.value.filter(u=>u.status==="进行中").length,n=f.value.filter(u=>u.status==="已完成").length,h=f.value.filter(u=>u.user_role==="creator"||u.user_role==="manager").length;return{total:s,active:e,completed:n,managed:h}}),B=N(()=>{let s=f.value;if(g.value){const e=g.value.toLowerCase();s=s.filter(n=>n.name.toLowerCase().includes(e)||n.description&&n.description.toLowerCase().includes(e))}return b.value&&(s=s.filter(e=>e.status===b.value)),v.value&&(v.value==="creator"?s=s.filter(e=>e.user_role==="creator"):s=s.filter(e=>e.user_role===v.value)),s}),E=s=>({进行中:"success",已完成:"info",已暂停:"warning",计划中:"",已取消:"danger"})[s]||"info",I=s=>({creator:"danger",manager:"warning",member:"info"})[s]||"info",A=s=>({creator:"创建者",manager:"管理员",member:"成员"})[s]||s,Q=s=>s?new Date(s).toLocaleDateString("zh-CN"):"",F=s=>{q.push(`/projects/${s}`)},J=async()=>{M.value=!0;try{const s=await we();f.value=s||[]}catch(s){console.error("加载项目列表失败:",s),U.error("加载项目列表失败: "+s.message),f.value=[]}finally{M.value=!1}},W=async()=>{try{const s=await Ve();C.value=s||[]}catch(s){console.error("加载组织列表失败:",s),U.error("加载组织列表失败: "+s.message),C.value=[]}},G=async()=>{var s;if(D.value){try{await D.value.validate()}catch{return}k.value=!0;try{const e={id:Date.now().toString(),name:r.name,description:r.description,status:r.status,organization_name:((s=C.value.find(n=>n.id===r.organization_id))==null?void 0:s.name)||"未知组织",user_role:"creator",task_count:0,member_count:1,completion_rate:0,created_at:new Date().toISOString()};f.value.unshift(e),U.success("项目创建成功"),w.value=!1,r.name="",r.description="",r.organization_id="",r.status="计划中"}catch(e){U.error("创建项目失败: "+e.message)}finally{k.value=!1}}};return oe(()=>{J(),W()}),(s,e)=>{const n=i("el-icon"),h=i("el-button"),u=i("el-card"),x=i("el-col"),H=i("el-row"),R=i("el-input"),c=i("el-option"),j=i("el-select"),K=i("el-skeleton"),L=i("el-tag"),X=i("el-dropdown-item"),Y=i("el-dropdown-menu"),Z=i("el-dropdown"),P=i("el-form-item"),ee=i("el-form"),te=i("el-dialog");return p(),V("div",Ce,[a("div",ze,[e[13]||(e[13]=a("div",{class:"header-content"},[a("h1",null,"项目管理"),a("p",null,"管理您参与的所有项目")],-1)),a("div",xe,[t(h,{type:"primary",onClick:e[0]||(e[0]=o=>w.value=!0)},{default:l(()=>[t(n,null,{default:l(()=>[t(_(de))]),_:1}),e[12]||(e[12]=y(" 创建项目 ",-1))]),_:1})])]),a("div",je,[a("div",Pe,[t(H,{gutter:20},{default:l(()=>[t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[a("div",Ue,[a("div",Me,[t(n,null,{default:l(()=>[t(_(ue))]),_:1})]),a("div",De,[a("div",Re,d(z.value.total),1),e[14]||(e[14]=a("div",{class:"stat-label"},"总项目数",-1))])])]),_:1})]),_:1}),t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[a("div",Se,[a("div",Be,[t(n,null,{default:l(()=>[t(_(ce))]),_:1})]),a("div",Fe,[a("div",Le,d(z.value.active),1),e[15]||(e[15]=a("div",{class:"stat-label"},"进行中",-1))])])]),_:1})]),_:1}),t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[a("div",Ne,[a("div",$e,[t(n,null,{default:l(()=>[t(_(_e))]),_:1})]),a("div",Oe,[a("div",qe,d(z.value.completed),1),e[16]||(e[16]=a("div",{class:"stat-label"},"已完成",-1))])])]),_:1})]),_:1}),t(x,{span:6},{default:l(()=>[t(u,{class:"stat-card"},{default:l(()=>[a("div",Te,[a("div",Ee,[t(n,null,{default:l(()=>[t(_(me))]),_:1})]),a("div",Ie,[a("div",Ae,d(z.value.managed),1),e[17]||(e[17]=a("div",{class:"stat-label"},"我管理的",-1))])])]),_:1})]),_:1})]),_:1})]),a("div",Qe,[a("div",Je,[t(R,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=o=>g.value=o),placeholder:"搜索项目名称或描述...",style:{width:"300px"},clearable:""},{prefix:l(()=>[t(n,null,{default:l(()=>[t(_(pe))]),_:1})]),_:1},8,["modelValue"])]),a("div",We,[t(j,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),placeholder:"项目状态",style:{width:"120px"},clearable:""},{default:l(()=>[t(c,{label:"进行中",value:"进行中"}),t(c,{label:"已完成",value:"已完成"}),t(c,{label:"已暂停",value:"已暂停"}),t(c,{label:"计划中",value:"计划中"})]),_:1},8,["modelValue"]),t(j,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=o=>v.value=o),placeholder:"我的角色",style:{width:"120px","margin-left":"12px"},clearable:""},{default:l(()=>[t(c,{label:"创建者",value:"creator"}),t(c,{label:"管理员",value:"manager"}),t(c,{label:"成员",value:"member"})]),_:1},8,["modelValue"])])]),a("div",Ge,[M.value?(p(),V("div",He,[t(K,{rows:3,animated:""})])):B.value.length===0?(p(),V("div",Ke,[t(n,null,{default:l(()=>[t(_(ve))]),_:1}),a("h3",null,d(g.value||b.value||v.value?"未找到匹配的项目":"暂无项目"),1),a("p",null,d(g.value||b.value||v.value?"尝试调整筛选条件":"创建您的第一个项目开始协作"),1),!g.value&&!b.value&&!v.value?(p(),S(h,{key:0,type:"primary",onClick:e[4]||(e[4]=o=>w.value=!0)},{default:l(()=>[...e[18]||(e[18]=[y(" 创建项目 ",-1)])]),_:1})):ne("",!0)])):(p(),V("div",Xe,[(p(!0),V($,null,O(B.value,o=>(p(),S(u,{key:o.id,class:"project-card",onClick:ae=>F(o.id)},{default:l(()=>[a("div",Ye,[a("div",Ze,[a("h3",null,d(o.name),1),t(L,{type:E(o.status),size:"small"},{default:l(()=>[y(d(o.status),1)]),_:2},1032,["type"])]),a("div",et,[t(Z,{trigger:"click",onClick:e[5]||(e[5]=ie(()=>{},["stop"]))},{dropdown:l(()=>[t(Y,null,{default:l(()=>[t(X,{onClick:ae=>F(o.id)},{default:l(()=>[t(n,null,{default:l(()=>[t(_(ge))]),_:1}),e[19]||(e[19]=y(" 查看详情 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),default:l(()=>[t(h,{type:"text",size:"small"},{default:l(()=>[t(n,null,{default:l(()=>[t(_(fe))]),_:1})]),_:1})]),_:2},1024)])]),a("div",tt,[a("p",null,d(o.description||"暂无描述"),1)]),a("div",at,[a("div",lt,[t(n,null,{default:l(()=>[t(_(be))]),_:1}),a("span",null,d(Q(o.created_at)),1)]),a("div",st,[t(n,null,{default:l(()=>[t(_(he))]),_:1}),a("span",null,d(o.organization_name||"未知组织"),1)])]),a("div",ot,[a("div",nt,[a("span",rt,d(o.task_count||0),1),e[20]||(e[20]=a("span",{class:"stat-label"},"任务",-1))]),a("div",it,[a("span",dt,d(o.member_count||0),1),e[21]||(e[21]=a("span",{class:"stat-label"},"成员",-1))]),a("div",ut,[a("span",ct,d(o.completion_rate||0)+"%",1),e[22]||(e[22]=a("span",{class:"stat-label"},"完成率",-1))])]),a("div",_t,[a("div",mt,[t(L,{size:"small",type:I(o.user_role)},{default:l(()=>[y(d(A(o.user_role)),1)]),_:2},1032,["type"])])])]),_:2},1032,["onClick"]))),128))]))])]),t(te,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=o=>w.value=o),title:"创建项目",width:"500px"},{footer:l(()=>[t(h,{onClick:e[10]||(e[10]=o=>w.value=!1)},{default:l(()=>[...e[23]||(e[23]=[y("取消",-1)])]),_:1}),t(h,{type:"primary",loading:k.value,onClick:G},{default:l(()=>[y(d(k.value?"创建中...":"创建"),1)]),_:1},8,["loading"])]),default:l(()=>[t(ee,{model:r,rules:T,ref_key:"projectFormRef",ref:D,"label-width":"80px"},{default:l(()=>[t(P,{label:"项目名称",prop:"name"},{default:l(()=>[t(R,{modelValue:r.name,"onUpdate:modelValue":e[6]||(e[6]=o=>r.name=o),placeholder:"请输入项目名称"},null,8,["modelValue"])]),_:1}),t(P,{label:"项目描述",prop:"description"},{default:l(()=>[t(R,{modelValue:r.description,"onUpdate:modelValue":e[7]||(e[7]=o=>r.description=o),type:"textarea",rows:3,placeholder:"请输入项目描述"},null,8,["modelValue"])]),_:1}),t(P,{label:"所属组织",prop:"organization_id"},{default:l(()=>[t(j,{modelValue:r.organization_id,"onUpdate:modelValue":e[8]||(e[8]=o=>r.organization_id=o),placeholder:"请选择组织",style:{width:"100%"}},{default:l(()=>[(p(!0),V($,null,O(C.value,o=>(p(),S(c,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(P,{label:"项目状态",prop:"status"},{default:l(()=>[t(j,{modelValue:r.status,"onUpdate:modelValue":e[9]||(e[9]=o=>r.status=o),placeholder:"请选择状态",style:{width:"100%"}},{default:l(()=>[t(c,{label:"计划中",value:"计划中"}),t(c,{label:"进行中",value:"进行中"}),t(c,{label:"已暂停",value:"已暂停"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),kt=ke(pt,[["__scopeId","data-v-4656959f"]]);export{kt as default};
