import{y as Ct,r as _,l as Ce,c as G,h as xt,z as f,A as c,R as t,J as a,al as y,aC as $t,B as l,O as d,u as p,P as i,I as j,L as P,Q as U,a6 as A,W as It,aB as jt}from"./vendor-D5A_PLSQ.js";import{E as g,q as Mt,s as Be,n as Ke,b as Dt,F as Tt,z as qe,u as xe,p as $e,t as Fe,d as ve,G as Ee,D as Ie,k as zt,w as St,H as Pt,I as Ut,y as At,J as Lt}from"./ui-DUo8Dfqk.js";import{b as Ot,d as Nt,e as Bt,f as Kt,h as qt,i as je,j as Ft,r as Et,k as Rt,l as Jt}from"./projects-C6oOc8Q2.js";import{b as Qt}from"./organizations-DV3rHeUx.js";import{u as Gt,s as Me}from"./index-1yu-MD6X.js";import{_ as Ht}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./supabase-C1h6x9Gt.js";const Wt={class:"project-detail"},Xt={class:"header-left"},Yt={class:"project-info"},Zt={class:"header-right"},el={class:"overview-content"},tl={class:"stats-grid"},ll={class:"stat-content"},sl={class:"stat-icon"},al={class:"stat-info"},ol={class:"stat-number"},nl={class:"stat-content"},il={class:"stat-icon"},dl={class:"stat-info"},rl={class:"stat-number"},ul={class:"stat-content"},cl={class:"stat-icon"},vl={class:"stat-info"},pl={class:"stat-number"},ml={class:"stat-content"},_l={class:"stat-icon"},fl={class:"stat-info"},gl={class:"stat-number"},yl={class:"content-grid"},kl={class:"activity-list"},wl={class:"activity-avatar"},bl={class:"activity-content"},Vl={class:"activity-time"},hl={class:"ai-content"},Cl={class:"ai-avatar"},xl={class:"tasks-section"},$l={class:"tasks-header"},Il={class:"task-board"},jl={class:"task-column"},Ml={class:"column-header"},Dl={class:"task-list"},Tl=["onClick"],zl={class:"task-meta"},Sl={class:"assignee"},Pl={class:"task-column"},Ul={class:"column-header"},Al={class:"task-list"},Ll=["onClick"],Ol={class:"task-meta"},Nl={class:"assignee"},Bl={class:"task-column"},Kl={class:"column-header"},ql={class:"task-list"},Fl=["onClick"],El={class:"task-meta"},Rl={class:"assignee"},Jl={class:"members-section"},Ql={class:"members-header"},Gl={class:"members-grid"},Hl={class:"member-info"},Wl={class:"member-details"},Xl={class:"member-stats"},Yl={class:"stat-item"},Zl={class:"stat-number"},es={key:0,class:"member-actions"},ts={class:"knowledge-section"},ls={class:"knowledge-header"},ss={class:"knowledge-actions"},as={class:"knowledge-content"},os={key:0,class:"empty-state"},ns={key:1,class:"empty-state"},is={key:2,class:"knowledge-grid"},ds={class:"knowledge-item-header"},rs={class:"knowledge-icon"},us={class:"knowledge-meta"},cs={class:"knowledge-item-content"},vs={class:"knowledge-item-footer"},ps={class:"author"},ms={class:"date"},_s={class:"member-option"},fs={class:"invitation-link-content"},gs={class:"invitation-link-box"},ys={class:"invitation-info"},ks={class:"delete-confirmation"},ws={class:"warning-icon"},bs={class:"warning-text"},Vs={class:"leave-dialog-content"},hs={key:0,class:"knowledge-detail-content"},Cs={class:"knowledge-detail-header"},xs={class:"knowledge-detail-meta"},$s={class:"knowledge-detail-author"},Is={class:"knowledge-detail-date"},js={key:0,class:"knowledge-detail-description"},Ms={class:"knowledge-detail-body"},Ds={key:0,class:"link-content"},Ts={class:"link-preview"},zs={class:"link-info"},Ss=["href"],Ps={key:1,class:"document-content"},Us={class:"content-viewer"},As={key:2,class:"knowledge-tags"},Ls={class:"tags-list"},Os={key:0,class:"task-detail-content"},Ns={class:"task-header"},Bs={class:"task-title"},Ks={class:"task-description"},qs={class:"task-meta-grid"},Fs={class:"meta-row"},Es={class:"meta-item"},Rs={class:"meta-label"},Js={class:"meta-item"},Qs={class:"meta-label"},Gs={class:"meta-row"},Hs={class:"meta-item full-width"},Ws={class:"meta-label"},Xs={class:"assignee-option"},Ys={class:"member-name"},Zs={key:0,class:"meta-row"},ea={class:"meta-item"},ta={class:"meta-label"},la={class:"due-date"},sa={class:"dialog-footer"},aa=Ct({__name:"ProjectDetail",setup(oa){const $=$t(),De=jt(),T=Gt(),Te=_("overview"),H=_(!1),ae=_(!1),K=_(!1),oe=_(!1),pe=_(!1),me=_(""),W=_(!1),X=_(!1),Y=_(!1),q=_(!1),_e=_(!1),fe=_([]),ne=_(!1),v=_(null),B=_(!1),Z=_(!1),b=_(null),ie=_(!1),F=_(""),h=_([]),ee=_(null),V=_(null),L=_([]),I=_([]),E=_([]),k=Ce({title:"",description:"",priority:"中",assignee:""}),C=Ce({selectedMember:"",role:"member"}),r=Ce({id:void 0,type:"document",title:"",description:"",content:"",url:"",tags:""}),Re={type:[{required:!0,message:"请选择文档类型",trigger:"change"}],title:[{required:!0,message:"请输入文档标题",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],url:[{required:!0,message:"请输入链接地址",trigger:"blur"},{type:"url",message:"请输入正确的链接地址",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},de=G(()=>{const o=I.value.length,e=I.value.filter(m=>m.status==="已完成").length,n=I.value.filter(m=>m.status==="进行中").length,u=L.value.length;return{totalTasks:o,completedTasks:e,inProgressTasks:n,totalMembers:u}}),ze=G(()=>I.value.filter(o=>o.status==="待办")),Se=G(()=>I.value.filter(o=>o.status==="进行中")),Pe=G(()=>I.value.filter(o=>o.status==="已完成")),R=_(!1),Je=G(()=>{if(!fe.value||!L.value)return[];const o=L.value.map(e=>e.user_id);return fe.value.filter(e=>!o.includes(e.user_id))}),ge=G(()=>{if(!F.value)return h.value;const o=F.value.toLowerCase();return h.value.filter(e=>e.title.toLowerCase().includes(o)||e.description&&e.description.toLowerCase().includes(o)||e.tags&&e.tags.toLowerCase().includes(o)||e.content&&e.content.toLowerCase().includes(o))}),Qe=async()=>{if(!V.value||!T.user){R.value=!1;return}if(V.value.created_by===T.user.id){R.value=!0;return}try{const{data:o}=await Me.from("organization_members").select("role").eq("organization_id",V.value.organization_id).eq("user_id",T.user.id).single();if((o==null?void 0:o.role)==="admin"){R.value=!0;return}const{data:e}=await Me.from("organizations").select("created_by").eq("id",V.value.organization_id).single();R.value=(e==null?void 0:e.created_by)===T.user.id}catch(o){console.error("检查权限失败:",o),R.value=!1}},Ge=o=>({进行中:"success",已完成:"info",已暂停:"warning",计划中:"",已取消:"danger"})[o]||"info",He=o=>({manager:"管理员",developer:"开发者",designer:"设计师",tester:"测试员",member:"普通成员"})[o]||o,We=o=>`https://api.dicebear.com/7.x/initials/svg?seed=${o}`,ye=o=>{const e=new Date(o),u=new Date().getTime()-e.getTime();return u<36e5?`${Math.floor(u/6e4)}分钟前`:u<864e5?`${Math.floor(u/36e5)}小时前`:e.toLocaleDateString("zh-CN")},Xe=async()=>{try{const o=await Ot($.params.id);V.value=o,await Qe()}catch(o){g.error("加载项目信息失败: "+o.message)}},re=async()=>{try{const o=await Nt($.params.id);L.value=o}catch(o){g.error("加载项目成员失败: "+o.message)}},Ue=async()=>{try{const o=await Bt($.params.id);I.value=o}catch(o){g.error("加载任务列表失败: "+o.message)}},Ye=async()=>{var o;if(!k.title){g.warning("请输入任务标题");return}ae.value=!0;try{if(!((o=T.user)!=null&&o.id))throw new Error("用户未登录");await qt({title:k.title,description:k.description,status:"待办",priority:k.priority,project_id:$.params.id,assigned_to:k.assignee||null}),g.success("任务创建成功"),H.value=!1;try{await je($.params.id,`创建了新任务"${k.title}"`,"task_created"),ue()}catch{J(`创建了新任务"${k.title}"`,"task_created")}k.title="",k.description="",k.priority="中",k.assignee="",Ue(),re()}catch(e){g.error("创建任务失败: "+e.message),console.error("创建任务错误详情:",e)}finally{ae.value=!1}},Ze=async()=>{if(V.value){_e.value=!0;try{const o=await Qt(V.value.organization_id);fe.value=o}catch(o){g.error("加载组织成员失败: "+o.message),console.error("加载组织成员错误详情:",o)}finally{_e.value=!1}}},et=async()=>{if(!C.selectedMember){g.warning("请选择要添加的成员");return}pe.value=!0;try{const{error:o}=await Me.from("project_members").insert({project_id:$.params.id,user_id:C.selectedMember,role:C.role});if(o)throw o;g.success("成员添加成功"),K.value=!1,C.selectedMember="",C.role="member",await re()}catch(o){g.error("添加成员失败: "+o.message),console.error("添加成员错误详情:",o)}finally{pe.value=!1}},tt=()=>{navigator.clipboard.writeText(me.value).then(()=>{g.success("邀请链接已复制到剪贴板")}).catch(o=>{console.error("复制失败:",o),g.error("复制失败，请手动复制")})},lt=()=>{W.value=!0},st=async()=>{X.value=!0;try{await Ft($.params.id),g.success("项目删除成功"),W.value=!1,De.back()}catch(o){g.error("删除项目失败: "+o.message),console.error("删除项目错误详情:",o)}finally{X.value=!1}},at=()=>{W.value=!1},ot=async()=>{var o,e;if(!(!((o=T.user)!=null&&o.id)||!((e=V.value)!=null&&e.id))){q.value=!0;try{await Et(V.value.id,T.user.id),g.success("已成功退出项目"),Y.value=!1,De.push(`/organizations/${V.value.organization_id}`)}catch(n){console.error("退出项目失败:",n),g.error("退出项目失败: "+(n.message||"未知错误"))}finally{q.value=!1}}},nt=()=>{oe.value=!1,C.email="",C.role="member",K.value=!0},it=()=>{g.info("AI聊天功能开发中")},ke=o=>{v.value=o,ne.value=!0},dt=o=>{switch(o){case"高":return"danger";case"中":return"warning";case"低":return"info";default:return"info"}},rt=o=>{switch(o){case"已完成":return"success";case"进行中":return"primary";case"待办":return"info";case"已暂停":return"warning";default:return"info"}},ut=o=>o?new Date(o).toLocaleDateString("zh-CN"):"",ct=async o=>{var e;if(v.value)try{await Rt(v.value.id,o),g.success("任务状态更新成功");const n=I.value.findIndex(u=>u.id===v.value.id);n!==-1&&(I.value[n].status=o);try{await je($.params.id,`将任务"${v.value.title}"状态更改为"${o}"`,"task_status_changed"),ue()}catch{J(`将任务"${v.value.title}"状态更改为"${o}"`,"task_status_changed")}}catch(n){g.error("更新任务状态失败: "+n.message),console.error("更新任务状态错误:",n),v.value.status=(e=I.value.find(u=>u.id===v.value.id))==null?void 0:e.status}},vt=async o=>{var e;if(v.value)try{await Jt(v.value.id,o);const n=o?L.value.find(M=>M.user_id===o):null,u=n?n.name||n.email:"未分配";g.success("任务负责人更新成功");const m=I.value.findIndex(M=>M.id===v.value.id);m!==-1&&(I.value[m].assigned_to=o,I.value[m].assigned_user=n?{full_name:n.name,email:n.email,display_name:n.name||n.email}:null),v.value.assigned_to=o,v.value.assigned_user=n?{full_name:n.name,email:n.email,display_name:n.name||n.email}:null;try{await je($.params.id,`将任务"${v.value.title}"分配给"${u}"`,"task_assigned"),ue()}catch{J(`将任务"${v.value.title}"分配给"${u}"`,"task_assigned")}re()}catch(n){g.error("更新任务负责人失败: "+n.message),console.error("更新任务负责人错误:",n),v.value.assigned_to=(e=I.value.find(u=>u.id===v.value.id))==null?void 0:e.assigned_to}},ue=async()=>{try{const o=await Kt($.params.id);E.value=o}catch(o){console.warn("加载项目活动失败:",o);const e=localStorage.getItem(`project_activities_${$.params.id}`);if(e)try{E.value=JSON.parse(e)}catch{E.value=[]}}},J=(o,e="general")=>{var m,M,te,le;const n={id:Date.now().toString(),description:`${((M=(m=T.user)==null?void 0:m.email)==null?void 0:M.split("@")[0])||"用户"} ${o}`,activity_type:e,created_at:new Date().toISOString(),user_name:((le=(te=T.user)==null?void 0:te.email)==null?void 0:le.split("@")[0])||"用户"};E.value.unshift(n);const u=$.params.id;localStorage.setItem(`project_activities_${u}`,JSON.stringify(E.value.slice(0,20)))},Ae=o=>({document:"文档",link:"链接",note:"笔记"})[o]||"文档",Le=o=>({document:"primary",link:"success",note:"warning"})[o]||"primary",pt=()=>{try{const o=$.params.id,e=localStorage.getItem(`project_knowledge_${o}`);if(e)try{h.value=JSON.parse(e),console.log("从本地存储加载知识库数据:",h.value)}catch(n){console.warn("解析本地存储数据失败:",n),h.value=[]}else console.log("初始化示例知识库数据"),h.value=[{id:"1",type:"document",title:"项目需求文档",description:"详细的项目需求说明和功能规格",content:`# 项目需求文档

## 1. 项目概述
本项目旨在开发一个现代化的项目管理系统...

## 2. 功能需求
- 用户管理
- 项目管理
- 任务管理
- 团队协作

## 3. 技术要求
- 前端：Vue 3 + TypeScript
- 后端：Node.js + Express
- 数据库：PostgreSQL`,tags:"需求,文档,规格",created_at:new Date(Date.now()-864e5*2).toISOString(),created_by_name:"产品经理"},{id:"2",type:"link",title:"API 文档",description:"项目后端 API 接口文档",url:"https://api-docs.example.com",tags:"API,接口,文档",created_at:new Date(Date.now()-864e5*1).toISOString(),created_by_name:"后端开发"},{id:"3",type:"note",title:"会议纪要 - 2024/01/15",description:"项目启动会议的重要决议和行动项",content:`会议时间：2024年1月15日 14:00-16:00
参会人员：产品经理、技术负责人、UI设计师

主要议题：
1. 项目范围确认
2. 技术架构讨论
3. 开发计划制定

决议事项：
- 采用微服务架构
- 使用 Vue 3 作为前端框架
- 预计开发周期 3 个月

行动项：
- 产品经理：完善需求文档（1月20日前）
- 技术负责人：搭建开发环境（1月25日前）
- UI设计师：提供设计稿（2月1日前）`,tags:"会议,纪要,决议",created_at:new Date().toISOString(),created_by_name:"项目经理"}],we();console.log("知识库数据加载完成，共",h.value.length,"项")}catch(o){console.error("加载知识库数据失败:",o),h.value=[]}},we=()=>{const o=$.params.id;localStorage.setItem(`project_knowledge_${o}`,JSON.stringify(h.value))},mt=o=>{b.value=o,Z.value=!0},Oe=o=>{r.type=o.type,r.title=o.title,r.description=o.description||"",r.content=o.content||"",r.url=o.url||"",r.tags=o.tags||"",r.id=o.id,Z.value=!1,B.value=!0},_t=o=>{Lt.confirm(`确定要删除文档"${o.title}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=h.value.findIndex(n=>n.id===o.id);e!==-1&&(h.value.splice(e,1),we(),g.success("文档删除成功"),J(`删除了知识库文档"${o.title}"`,"knowledge_deleted"))}).catch(()=>{})},ft=async()=>{var o,e;if(ee.value){try{await ee.value.validate()}catch{return}ie.value=!0;try{const n=!!r.id,u=new Date().toISOString();if(n){const m=h.value.findIndex(M=>M.id===r.id);m!==-1&&(h.value[m]={...h.value[m],type:r.type,title:r.title,description:r.description,content:r.content,url:r.url,tags:r.tags,updated_at:u},g.success("文档更新成功"),J(`更新了知识库文档"${r.title}"`,"knowledge_updated"))}else{const m={id:Date.now().toString(),type:r.type,title:r.title,description:r.description,content:r.content,url:r.url,tags:r.tags,created_at:u,created_by_name:((e=(o=T.user)==null?void 0:o.email)==null?void 0:e.split("@")[0])||"用户"};h.value.unshift(m),g.success("文档添加成功"),J(`添加了知识库文档"${r.title}"`,"knowledge_created")}we(),B.value=!1,gt()}catch(n){g.error("保存失败: "+n.message)}finally{ie.value=!1}}},gt=()=>{r.id=void 0,r.type="document",r.title="",r.description="",r.content="",r.url="",r.tags="",ee.value&&ee.value.resetFields()};return xt(()=>{Xe(),re(),Ue(),ue(),pt()}),(o,e)=>{var Ne;const n=y("el-icon"),u=y("el-button"),m=y("el-tag"),M=y("el-dropdown-item"),te=y("el-dropdown-menu"),le=y("el-dropdown"),yt=y("el-header"),O=y("el-card"),ce=y("el-tab-pane"),be=y("el-badge"),kt=y("el-avatar"),z=y("el-input"),wt=y("el-tabs"),bt=y("el-main"),Vt=y("el-container"),D=y("el-form-item"),x=y("el-option"),Q=y("el-select"),Ve=y("el-form"),N=y("el-dialog"),he=y("el-radio"),ht=y("el-radio-group");return c(),f("div",Wt,[t(Vt,null,{default:a(()=>[t(yt,{class:"header"},{default:a(()=>{var s,w,S;return[l("div",Xt,[t(u,{type:"text",onClick:e[0]||(e[0]=se=>o.$router.back()),class:"back-btn"},{default:a(()=>[t(n,null,{default:a(()=>[t(p(Mt))]),_:1}),e[41]||(e[41]=d(" 返回 ",-1))]),_:1}),l("div",Yt,[l("h1",null,i((s=V.value)==null?void 0:s.name),1),l("p",null,i(((w=V.value)==null?void 0:w.description)||"暂无描述"),1)])]),l("div",Zt,[t(m,{type:Ge((S=V.value)==null?void 0:S.status),size:"large"},{default:a(()=>{var se;return[d(i((se=V.value)==null?void 0:se.status),1)]}),_:1},8,["type"]),R.value?(c(),j(le,{key:0,trigger:"click",class:"project-actions"},{dropdown:a(()=>[t(te,null,{default:a(()=>[t(M,{onClick:lt},{default:a(()=>[t(n,null,{default:a(()=>[t(p(Ke))]),_:1}),e[42]||(e[42]=d(" 删除项目 ",-1))]),_:1})]),_:1})]),default:a(()=>[t(u,{type:"primary",icon:p(Be),circle:""},null,8,["icon"])]),_:1})):P("",!0)])]}),_:1}),t(bt,{class:"main-content"},{default:a(()=>[t(wt,{modelValue:Te.value,"onUpdate:modelValue":e[8]||(e[8]=s=>Te.value=s),class:"project-tabs"},{default:a(()=>[t(ce,{label:"项目概览",name:"overview"},{default:a(()=>[l("div",el,[l("div",tl,[t(O,{class:"stat-card"},{default:a(()=>[l("div",ll,[l("div",sl,[t(n,{color:"#409eff"},{default:a(()=>[t(p(Dt))]),_:1})]),l("div",al,[l("div",ol,i(de.value.totalTasks),1),e[43]||(e[43]=l("div",{class:"stat-label"},"总任务数",-1))])])]),_:1}),t(O,{class:"stat-card"},{default:a(()=>[l("div",nl,[l("div",il,[t(n,{color:"#67c23a"},{default:a(()=>[t(p(Tt))]),_:1})]),l("div",dl,[l("div",rl,i(de.value.completedTasks),1),e[44]||(e[44]=l("div",{class:"stat-label"},"已完成",-1))])])]),_:1}),t(O,{class:"stat-card"},{default:a(()=>[l("div",ul,[l("div",cl,[t(n,{color:"#e6a23c"},{default:a(()=>[t(p(qe))]),_:1})]),l("div",vl,[l("div",pl,i(de.value.inProgressTasks),1),e[45]||(e[45]=l("div",{class:"stat-label"},"进行中",-1))])])]),_:1}),t(O,{class:"stat-card"},{default:a(()=>[l("div",ml,[l("div",_l,[t(n,{color:"#909399"},{default:a(()=>[t(p(xe))]),_:1})]),l("div",fl,[l("div",gl,i(de.value.totalMembers),1),e[46]||(e[46]=l("div",{class:"stat-label"},"团队成员",-1))])])]),_:1})]),l("div",yl,[t(O,{class:"recent-activities"},{header:a(()=>[...e[47]||(e[47]=[l("span",null,"最近活动",-1)])]),default:a(()=>[l("div",kl,[(c(!0),f(U,null,A(E.value,s=>(c(),f("div",{key:s.id,class:"activity-item"},[l("div",wl,[t(n,null,{default:a(()=>[t(p(xe))]),_:1})]),l("div",bl,[l("p",null,i(s.description),1),l("span",Vl,i(ye(s.created_at)),1)])]))),128))])]),_:1}),t(O,{class:"ai-assistant"},{header:a(()=>[...e[48]||(e[48]=[l("span",null,"AI 项目助手",-1)])]),default:a(()=>[l("div",hl,[l("div",Cl,[t(n,null,{default:a(()=>[t(p(Be))]),_:1})]),e[49]||(e[49]=l("div",{class:"ai-message"},[l("p",null,"我是您的项目AI助手，可以帮助您分析项目进度、识别风险、优化任务分配。有什么需要帮助的吗？")],-1))]),t(u,{type:"primary",style:{width:"100%","margin-top":"16px"},onClick:it},{default:a(()=>[...e[50]||(e[50]=[d(" 开始对话 ",-1)])]),_:1})]),_:1})])])]),_:1}),t(ce,{label:"任务管理",name:"tasks"},{default:a(()=>[l("div",xl,[l("div",$l,[e[52]||(e[52]=l("h3",null,"项目任务",-1)),t(u,{type:"primary",onClick:e[1]||(e[1]=s=>H.value=!0)},{default:a(()=>[t(n,null,{default:a(()=>[t(p($e))]),_:1}),e[51]||(e[51]=d(" 创建任务 ",-1))]),_:1})]),l("div",Il,[l("div",jl,[l("div",Ml,[e[53]||(e[53]=l("h4",null,"待办",-1)),t(be,{value:ze.value.length},null,8,["value"])]),l("div",Dl,[(c(!0),f(U,null,A(ze.value,s=>{var w,S;return c(),f("div",{key:s.id,class:"task-card",onClick:se=>ke(s)},[l("h5",null,i(s.title),1),l("p",null,i(s.description),1),l("div",zl,[t(m,{size:"small"},{default:a(()=>[d(i(s.priority),1)]),_:2},1024),l("span",Sl,i(((w=s.assigned_user)==null?void 0:w.full_name)||((S=s.assigned_user)==null?void 0:S.email)||"未分配"),1)])],8,Tl)}),128))])]),l("div",Pl,[l("div",Ul,[e[54]||(e[54]=l("h4",null,"进行中",-1)),t(be,{value:Se.value.length},null,8,["value"])]),l("div",Al,[(c(!0),f(U,null,A(Se.value,s=>{var w;return c(),f("div",{key:s.id,class:"task-card",onClick:S=>ke(s)},[l("h5",null,i(s.title),1),l("p",null,i(s.description),1),l("div",Ol,[t(m,{size:"small",type:"warning"},{default:a(()=>[d(i(s.priority),1)]),_:2},1024),l("span",Nl,i(((w=s.assigned_user)==null?void 0:w.display_name)||"未分配"),1)])],8,Ll)}),128))])]),l("div",Bl,[l("div",Kl,[e[55]||(e[55]=l("h4",null,"已完成",-1)),t(be,{value:Pe.value.length},null,8,["value"])]),l("div",ql,[(c(!0),f(U,null,A(Pe.value,s=>{var w,S;return c(),f("div",{key:s.id,class:"task-card completed",onClick:se=>ke(s)},[l("h5",null,i(s.title),1),l("p",null,i(s.description),1),l("div",El,[t(m,{size:"small",type:"success"},{default:a(()=>[d(i(s.priority),1)]),_:2},1024),l("span",Rl,i(((w=s.assigned_user)==null?void 0:w.full_name)||((S=s.assigned_user)==null?void 0:S.email)||"未分配"),1)])],8,Fl)}),128))])])])])]),_:1}),t(ce,{label:"团队成员",name:"members"},{default:a(()=>[l("div",Jl,[l("div",Ql,[e[57]||(e[57]=l("h3",null,"项目成员",-1)),t(u,{type:"primary",size:"small",onClick:e[2]||(e[2]=s=>K.value=!0)},{default:a(()=>[t(n,null,{default:a(()=>[t(p($e))]),_:1}),e[56]||(e[56]=d(" 添加成员 ",-1))]),_:1})]),l("div",Gl,[(c(!0),f(U,null,A(L.value,s=>(c(),j(O,{key:s.id,class:"member-card"},{default:a(()=>{var w;return[l("div",Hl,[t(kt,{size:48,src:We(s.email)},null,8,["src"]),l("div",Wl,[l("h4",null,i(s.name||s.email),1),l("p",null,i(s.role),1)])]),l("div",Xl,[l("div",Yl,[l("span",Zl,i(s.taskCount||0),1),e[58]||(e[58]=l("span",{class:"stat-label"},"任务",-1))]),s.user_id===((w=p(T).user)==null?void 0:w.id)?(c(),f("div",es,[t(u,{type:"danger",size:"small",onClick:e[3]||(e[3]=S=>Y.value=!0),loading:q.value},{default:a(()=>[...e[59]||(e[59]=[d(" 退出项目 ",-1)])]),_:1},8,["loading"])])):P("",!0)])]}),_:2},1024))),128))])])]),_:1}),t(ce,{label:"知识库",name:"knowledge"},{default:a(()=>[l("div",ts,[l("div",ls,[e[61]||(e[61]=l("h3",null,"项目知识库",-1)),l("div",ss,[t(z,{modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=s=>F.value=s),placeholder:"搜索文档...",style:{width:"200px","margin-right":"12px"},clearable:""},{prefix:a(()=>[t(n,null,{default:a(()=>[t(p(Fe))]),_:1})]),_:1},8,["modelValue"]),t(u,{type:"primary",size:"small",onClick:e[5]||(e[5]=s=>B.value=!0)},{default:a(()=>[t(n,null,{default:a(()=>[t(p($e))]),_:1}),e[60]||(e[60]=d(" 添加文档 ",-1))]),_:1})])]),l("div",as,[ge.value.length===0&&!F.value?(c(),f("div",os,[t(n,null,{default:a(()=>[t(p(ve))]),_:1}),e[63]||(e[63]=l("h3",null,"知识库为空",-1)),e[64]||(e[64]=l("p",null,"添加项目相关文档来构建知识库",-1)),t(u,{type:"primary",onClick:e[6]||(e[6]=s=>B.value=!0)},{default:a(()=>[...e[62]||(e[62]=[d("添加文档",-1)])]),_:1})])):ge.value.length===0&&F.value?(c(),f("div",ns,[t(n,null,{default:a(()=>[t(p(Fe))]),_:1}),e[65]||(e[65]=l("h3",null,"未找到相关文档",-1)),e[66]||(e[66]=l("p",null,"尝试使用其他关键词搜索",-1))])):(c(),f("div",is,[(c(!0),f(U,null,A(ge.value,s=>(c(),j(O,{key:s.id,class:"knowledge-item",onClick:w=>mt(s)},{default:a(()=>[l("div",ds,[l("div",rs,[s.type==="document"?(c(),j(n,{key:0},{default:a(()=>[t(p(ve))]),_:1})):s.type==="link"?(c(),j(n,{key:1},{default:a(()=>[t(p(Ee))]),_:1})):s.type==="note"?(c(),j(n,{key:2},{default:a(()=>[t(p(Ie))]),_:1})):(c(),j(n,{key:3},{default:a(()=>[t(p(ve))]),_:1}))]),l("div",us,[t(m,{type:Le(s.type),size:"small"},{default:a(()=>[d(i(Ae(s.type)),1)]),_:2},1032,["type"]),t(le,{trigger:"click",onClick:e[7]||(e[7]=It(()=>{},["stop"]))},{dropdown:a(()=>[t(te,null,{default:a(()=>[t(M,{onClick:w=>Oe(s)},{default:a(()=>[t(n,null,{default:a(()=>[t(p(Ie))]),_:1}),e[67]||(e[67]=d(" 编辑 ",-1))]),_:1},8,["onClick"]),t(M,{onClick:w=>_t(s),divided:""},{default:a(()=>[t(n,null,{default:a(()=>[t(p(Ke))]),_:1}),e[68]||(e[68]=d(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[t(u,{type:"text",size:"small"},{default:a(()=>[t(n,null,{default:a(()=>[t(p(zt))]),_:1})]),_:1})]),_:2},1024)])]),l("div",cs,[l("h4",null,i(s.title),1),l("p",null,i(s.description||"暂无描述"),1),l("div",vs,[l("span",ps,i(s.created_by_name||"未知"),1),l("span",ms,i(ye(s.created_at)),1)])])]),_:2},1032,["onClick"]))),128))]))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(N,{modelValue:H.value,"onUpdate:modelValue":e[14]||(e[14]=s=>H.value=s),title:"创建任务",width:"500px"},{footer:a(()=>[t(u,{onClick:e[13]||(e[13]=s=>H.value=!1)},{default:a(()=>[...e[69]||(e[69]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",loading:ae.value,onClick:Ye,disabled:!k.title},{default:a(()=>[d(i(ae.value?"创建中...":"创建"),1)]),_:1},8,["loading","disabled"])]),default:a(()=>[t(Ve,{model:k,"label-width":"80px"},{default:a(()=>[t(D,{label:"任务标题"},{default:a(()=>[t(z,{modelValue:k.title,"onUpdate:modelValue":e[9]||(e[9]=s=>k.title=s),placeholder:"请输入任务标题"},null,8,["modelValue"])]),_:1}),t(D,{label:"任务描述"},{default:a(()=>[t(z,{modelValue:k.description,"onUpdate:modelValue":e[10]||(e[10]=s=>k.description=s),type:"textarea",rows:3,placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1}),t(D,{label:"优先级"},{default:a(()=>[t(Q,{modelValue:k.priority,"onUpdate:modelValue":e[11]||(e[11]=s=>k.priority=s),placeholder:"请选择优先级"},{default:a(()=>[t(x,{label:"高",value:"高"}),t(x,{label:"中",value:"中"}),t(x,{label:"低",value:"低"})]),_:1},8,["modelValue"])]),_:1}),t(D,{label:"指派给"},{default:a(()=>[t(Q,{modelValue:k.assignee,"onUpdate:modelValue":e[12]||(e[12]=s=>k.assignee=s),placeholder:"请选择成员"},{default:a(()=>[(c(!0),f(U,null,A(L.value,s=>(c(),j(x,{key:s.id,label:s.name||s.email,value:s.user_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(N,{modelValue:K.value,"onUpdate:modelValue":e[18]||(e[18]=s=>K.value=s),title:"添加项目成员",width:"500px",onOpen:Ze},{footer:a(()=>[t(u,{onClick:e[17]||(e[17]=s=>K.value=!1)},{default:a(()=>[...e[70]||(e[70]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",loading:pe.value,onClick:et,disabled:!C.selectedMember},{default:a(()=>[...e[71]||(e[71]=[d(" 添加到项目 ",-1)])]),_:1},8,["loading","disabled"])]),default:a(()=>[t(Ve,{model:C,"label-width":"80px"},{default:a(()=>[t(D,{label:"选择成员"},{default:a(()=>[t(Q,{modelValue:C.selectedMember,"onUpdate:modelValue":e[15]||(e[15]=s=>C.selectedMember=s),placeholder:"请选择组织成员",filterable:"",loading:_e.value},{default:a(()=>[(c(!0),f(U,null,A(Je.value,s=>(c(),j(x,{key:s.user_id,label:s.email||s.user_id,value:s.user_id},{default:a(()=>[l("div",_s,[l("span",null,i(s.name||s.email||"未知用户"),1),t(m,{size:"small",type:"info"},{default:a(()=>[d(i(s.role),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(D,{label:"项目角色"},{default:a(()=>[t(Q,{modelValue:C.role,"onUpdate:modelValue":e[16]||(e[16]=s=>C.role=s),placeholder:"请选择项目角色"},{default:a(()=>[t(x,{label:"管理员",value:"manager"}),t(x,{label:"开发者",value:"developer"}),t(x,{label:"设计师",value:"designer"}),t(x,{label:"测试员",value:"tester"}),t(x,{label:"普通成员",value:"member"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(N,{modelValue:oe.value,"onUpdate:modelValue":e[21]||(e[21]=s=>oe.value=s),title:"成员邀请链接",width:"500px"},{footer:a(()=>[t(u,{onClick:e[20]||(e[20]=s=>oe.value=!1)},{default:a(()=>[...e[77]||(e[77]=[d("关闭",-1)])]),_:1}),t(u,{type:"primary",onClick:nt},{default:a(()=>[...e[78]||(e[78]=[d("添加另一个成员",-1)])]),_:1})]),default:a(()=>[l("div",fs,[e[76]||(e[76]=l("p",null,"已成功创建成员邀请链接，您可以将此链接发送给新成员：",-1)),l("div",gs,[t(z,{modelValue:me.value,"onUpdate:modelValue":e[19]||(e[19]=s=>me.value=s),readonly:"",size:"large"},{append:a(()=>[t(u,{onClick:tt},{default:a(()=>[t(n,null,{default:a(()=>[t(p(ve))]),_:1}),e[72]||(e[72]=d(" 复制 ",-1))]),_:1})]),_:1},8,["modelValue"])]),l("div",ys,[l("p",null,[e[73]||(e[73]=l("strong",null,"成员邮箱：",-1)),d(i(C.email),1)]),l("p",null,[e[74]||(e[74]=l("strong",null,"成员角色：",-1)),d(i(He(C.role)),1)]),e[75]||(e[75]=l("p",null,[l("strong",null,"链接有效期："),d("7天")],-1))])])]),_:1},8,["modelValue"]),t(N,{modelValue:W.value,"onUpdate:modelValue":e[22]||(e[22]=s=>W.value=s),title:"删除项目",width:"400px","close-on-click-modal":!1},{footer:a(()=>[t(u,{onClick:at,disabled:X.value},{default:a(()=>[...e[82]||(e[82]=[d("取消",-1)])]),_:1},8,["disabled"]),t(u,{type:"danger",onClick:st,loading:X.value},{default:a(()=>[d(i(X.value?"删除中...":"确认删除"),1)]),_:1},8,["loading"])]),default:a(()=>{var s;return[l("div",ks,[l("div",ws,[t(n,{color:"#E6A23C",size:"48"},{default:a(()=>[t(p(St))]),_:1})]),l("div",bs,[l("p",null,[l("strong",null,'确定要删除项目 "'+i((s=V.value)==null?void 0:s.name)+'" 吗？',1)]),e[79]||(e[79]=l("p",null,"此操作将永久删除项目及其所有相关数据，包括：",-1)),e[80]||(e[80]=l("ul",null,[l("li",null,"项目中的所有任务"),l("li",null,"项目成员关系"),l("li",null,"项目相关文档")],-1)),e[81]||(e[81]=l("p",null,[l("strong",null,"此操作不可撤销！")],-1))])])]}),_:1},8,["modelValue"]),t(N,{modelValue:Y.value,"onUpdate:modelValue":e[24]||(e[24]=s=>Y.value=s),title:"确认退出项目",width:"400px","close-on-click-modal":!1},{footer:a(()=>[t(u,{onClick:e[23]||(e[23]=s=>Y.value=!1),disabled:q.value},{default:a(()=>[...e[86]||(e[86]=[d("取消",-1)])]),_:1},8,["disabled"]),t(u,{type:"danger",onClick:ot,loading:q.value},{default:a(()=>[d(i(q.value?"退出中...":"确认退出"),1)]),_:1},8,["loading"])]),default:a(()=>{var s;return[l("div",Vs,[l("p",null,[e[83]||(e[83]=d("您确定要退出项目 ",-1)),l("strong",null,i((s=V.value)==null?void 0:s.name),1),e[84]||(e[84]=d(" 吗？",-1))]),e[85]||(e[85]=l("p",{class:"warning-text"},"退出后，您将失去对该项目及其所有任务的访问权限。",-1))])]}),_:1},8,["modelValue"]),t(N,{modelValue:B.value,"onUpdate:modelValue":e[33]||(e[33]=s=>B.value=s),title:"添加知识库文档",width:"600px"},{footer:a(()=>[t(u,{onClick:e[32]||(e[32]=s=>B.value=!1)},{default:a(()=>[...e[90]||(e[90]=[d("取消",-1)])]),_:1}),t(u,{type:"primary",loading:ie.value,onClick:ft},{default:a(()=>[d(i(ie.value?"保存中...":"保存"),1)]),_:1},8,["loading"])]),default:a(()=>[t(Ve,{model:r,"label-width":"80px",rules:Re,ref_key:"documentFormRef",ref:ee},{default:a(()=>[t(D,{label:"文档类型",prop:"type"},{default:a(()=>[t(ht,{modelValue:r.type,"onUpdate:modelValue":e[25]||(e[25]=s=>r.type=s)},{default:a(()=>[t(he,{label:"document"},{default:a(()=>[...e[87]||(e[87]=[d("文档",-1)])]),_:1}),t(he,{label:"link"},{default:a(()=>[...e[88]||(e[88]=[d("链接",-1)])]),_:1}),t(he,{label:"note"},{default:a(()=>[...e[89]||(e[89]=[d("笔记",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(D,{label:"标题",prop:"title"},{default:a(()=>[t(z,{modelValue:r.title,"onUpdate:modelValue":e[26]||(e[26]=s=>r.title=s),placeholder:"请输入文档标题"},null,8,["modelValue"])]),_:1}),t(D,{label:"描述",prop:"description"},{default:a(()=>[t(z,{modelValue:r.description,"onUpdate:modelValue":e[27]||(e[27]=s=>r.description=s),type:"textarea",rows:3,placeholder:"请输入文档描述"},null,8,["modelValue"])]),_:1}),r.type==="link"?(c(),j(D,{key:0,label:"链接地址",prop:"url"},{default:a(()=>[t(z,{modelValue:r.url,"onUpdate:modelValue":e[28]||(e[28]=s=>r.url=s),placeholder:"请输入链接地址"},null,8,["modelValue"])]),_:1})):P("",!0),r.type==="document"?(c(),j(D,{key:1,label:"文档内容",prop:"content"},{default:a(()=>[t(z,{modelValue:r.content,"onUpdate:modelValue":e[29]||(e[29]=s=>r.content=s),type:"textarea",rows:8,placeholder:"请输入文档内容"},null,8,["modelValue"])]),_:1})):P("",!0),r.type==="note"?(c(),j(D,{key:2,label:"笔记内容",prop:"content"},{default:a(()=>[t(z,{modelValue:r.content,"onUpdate:modelValue":e[30]||(e[30]=s=>r.content=s),type:"textarea",rows:6,placeholder:"请输入笔记内容"},null,8,["modelValue"])]),_:1})):P("",!0),t(D,{label:"标签"},{default:a(()=>[t(z,{modelValue:r.tags,"onUpdate:modelValue":e[31]||(e[31]=s=>r.tags=s),placeholder:"请输入标签，用逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(N,{modelValue:Z.value,"onUpdate:modelValue":e[36]||(e[36]=s=>Z.value=s),title:(Ne=b.value)==null?void 0:Ne.title,width:"800px",class:"knowledge-detail-dialog"},{footer:a(()=>[t(u,{onClick:e[34]||(e[34]=s=>Z.value=!1)},{default:a(()=>[...e[93]||(e[93]=[d("关闭",-1)])]),_:1}),t(u,{type:"primary",onClick:e[35]||(e[35]=s=>Oe(b.value))},{default:a(()=>[t(n,null,{default:a(()=>[t(p(Ie))]),_:1}),e[94]||(e[94]=d(" 编辑 ",-1))]),_:1})]),default:a(()=>[b.value?(c(),f("div",hs,[l("div",Cs,[l("div",xs,[t(m,{type:Le(b.value.type),size:"small"},{default:a(()=>[d(i(Ae(b.value.type)),1)]),_:1},8,["type"]),l("span",$s," 创建者："+i(b.value.created_by_name||"未知"),1),l("span",Is,i(ye(b.value.created_at)),1)]),b.value.description?(c(),f("div",js,[l("p",null,i(b.value.description),1)])):P("",!0)]),l("div",Ms,[b.value.type==="link"?(c(),f("div",Ds,[l("div",Ts,[t(n,null,{default:a(()=>[t(p(Ee))]),_:1}),l("div",zs,[e[91]||(e[91]=l("h4",null,"外部链接",-1)),l("a",{href:b.value.url,target:"_blank",class:"external-link"},[d(i(b.value.url)+" ",1),t(n,null,{default:a(()=>[t(p(Pt))]),_:1})],8,Ss)])])])):(c(),f("div",Ps,[l("div",Us,[l("pre",null,i(b.value.content||"暂无内容"),1)])])),b.value.tags?(c(),f("div",As,[e[92]||(e[92]=l("h5",null,"标签",-1)),l("div",Ls,[(c(!0),f(U,null,A(b.value.tags.split(","),s=>(c(),j(m,{key:s.trim(),size:"small",style:{"margin-right":"8px","margin-bottom":"4px"}},{default:a(()=>[d(i(s.trim()),1)]),_:2},1024))),128))])])):P("",!0)])])):P("",!0)]),_:1},8,["modelValue","title"]),t(N,{modelValue:ne.value,"onUpdate:modelValue":e[40]||(e[40]=s=>ne.value=s),title:"任务详情",width:"650px",class:"task-detail-dialog"},{footer:a(()=>[l("div",sa,[t(u,{onClick:e[39]||(e[39]=s=>ne.value=!1)},{default:a(()=>[...e[100]||(e[100]=[d("关闭",-1)])]),_:1})])]),default:a(()=>[v.value?(c(),f("div",Os,[l("div",Ns,[l("h3",Bs,i(v.value.title),1),t(m,{type:rt(v.value.status),size:"large",class:"status-tag"},{default:a(()=>[d(i(v.value.status),1)]),_:1},8,["type"])]),l("div",Ks,[e[95]||(e[95]=l("h4",null,"任务描述",-1)),l("p",null,i(v.value.description||"暂无描述"),1)]),l("div",qs,[l("div",Fs,[l("div",Es,[l("label",Rs,[t(n,null,{default:a(()=>[t(p(Ut))]),_:1}),e[96]||(e[96]=d(" 优先级 ",-1))]),t(m,{type:dt(v.value.priority),size:"small"},{default:a(()=>[d(i(v.value.priority),1)]),_:1},8,["type"])]),l("div",Js,[l("label",Qs,[t(n,null,{default:a(()=>[t(p(qe))]),_:1}),e[97]||(e[97]=d(" 状态 ",-1))]),t(Q,{modelValue:v.value.status,"onUpdate:modelValue":e[37]||(e[37]=s=>v.value.status=s),size:"small",class:"status-select",disabled:v.value.status==="已完成",onChange:ct},{default:a(()=>[t(x,{label:"待办",value:"待办"}),t(x,{label:"进行中",value:"进行中"}),t(x,{label:"已完成",value:"已完成"}),t(x,{label:"已暂停",value:"已暂停"})]),_:1},8,["modelValue","disabled"])])]),l("div",Gs,[l("div",Hs,[l("label",Ws,[t(n,null,{default:a(()=>[t(p(xe))]),_:1}),e[98]||(e[98]=d(" 负责人 ",-1))]),t(Q,{modelValue:v.value.assigned_to,"onUpdate:modelValue":e[38]||(e[38]=s=>v.value.assigned_to=s),size:"small",class:"assignee-select",placeholder:"请选择负责人",clearable:"",disabled:v.value.status==="已完成",onChange:vt},{default:a(()=>[(c(!0),f(U,null,A(L.value,s=>(c(),j(x,{key:s.user_id,label:s.name||s.email,value:s.user_id},{default:a(()=>[l("div",Xs,[l("span",Ys,i(s.name||s.email),1),t(m,{size:"small",type:"info"},{default:a(()=>[d(i(s.role),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),v.value.due_date?(c(),f("div",Zs,[l("div",ea,[l("label",ta,[t(n,null,{default:a(()=>[t(p(At))]),_:1}),e[99]||(e[99]=d(" 截止日期 ",-1))]),l("span",la,i(ut(v.value.due_date)),1)])])):P("",!0)])])):P("",!0)]),_:1},8,["modelValue"])])}}}),pa=Ht(aa,[["__scopeId","data-v-d51b1c66"]]);export{pa as default};
