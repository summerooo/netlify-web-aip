import{y as I,r as D,c as A,h as B,z as j,A as y,B as t,P as l,R as e,J as a,al as C,I as E,L as x,u as g,O as h,Q as N,a6 as P,aB as q}from"./vendor-D5A_PLSQ.js";import{o as R,f as $,b as V,d as L,s as M,e as O}from"./ui-DUo8Dfqk.js";import{s as w,u as T}from"./index-1yu-MD6X.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./supabase-C1h6x9Gt.js";async function J(v){try{const{data:o,error:r}=await w.from("organization_members").select("organization_id").eq("user_id",v);if(r)return console.warn("获取组织数据失败:",r),{organizations:0,projects:0,tasks:0,documents:0};const c=(o==null?void 0:o.map(b=>b.organization_id))||[];let u=[];if(c.length>0){const{data:b,error:i}=await w.from("projects").select("id").in("organization_id",c);i?console.warn("获取项目数据失败:",i):u=b||[]}const{data:n,error:m}=await w.from("tasks").select("id").eq("assigned_to",v);m&&console.warn("获取任务数据失败:",m);const{data:f,error:z}=await w.from("documents").select("id").eq("created_by",v);return z&&console.warn("获取文档数据失败:",z),{organizations:(o==null?void 0:o.length)||0,projects:(u==null?void 0:u.length)||0,tasks:(n==null?void 0:n.length)||0,documents:(f==null?void 0:f.length)||0}}catch(o){return console.error("获取用户统计数据失败:",o),{organizations:0,projects:0,tasks:0,documents:0}}}async function Q(v,o=5){try{const{data:r,error:c}=await w.from("organization_members").select("organization_id").eq("user_id",v);if(c)return console.warn("获取组织成员数据失败:",c),[];const u=(r==null?void 0:r.map(f=>f.organization_id))||[];if(u.length===0)return console.log("用户还没有加入任何组织"),[];const{data:n,error:m}=await w.from("projects").select(`
        *,
        organization:organizations(name)
      `).in("organization_id",u).order("updated_at",{ascending:!1}).limit(o);return m?(console.warn("获取项目数据失败:",m),[]):n||[]}catch(r){return console.error("获取最近项目失败:",r),[]}}async function U(v,o=10){return[{id:1,description:'创建了新项目"移动应用开发"',created_at:new Date().toISOString()},{id:2,description:'完成了任务"用户界面设计"',created_at:new Date(Date.now()-36e5).toISOString()}]}const G={class:"dashboard"},H={class:"dashboard-content"},K={class:"welcome-section"},W={class:"stats-grid"},X={class:"stat-content"},Y={class:"stat-icon"},Z={class:"stat-info"},tt={class:"stat-number"},st={class:"stat-content"},et={class:"stat-icon"},at={class:"stat-info"},ot={class:"stat-number"},nt={class:"stat-content"},rt={class:"stat-icon"},it={class:"stat-info"},lt={class:"stat-number"},dt={class:"stat-content"},ct={class:"stat-icon"},ut={class:"stat-info"},_t={class:"stat-number"},pt={class:"content-grid"},ft={class:"card-header"},vt={key:0,class:"empty-state"},mt={key:1,class:"project-list"},gt=["onClick"],yt={class:"project-info"},ht={class:"project-status"},wt={class:"ai-content"},bt={class:"ai-avatar"},kt={class:"card-header"},jt={class:"project-detail-content"},zt={class:"project-description"},Dt={class:"project-meta"},Ct={class:"project-date"},St=I({__name:"Dashboard",setup(v){q();const o=T(),r=D({organizations:0,projects:0,tasks:0,documents:0}),c=D([]),u=D([]),n=D(null),m=A(()=>new Date().toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})),f=i=>({进行中:"success",已完成:"info",已暂停:"warning",已取消:"danger"})[i]||"info",z=i=>{n.value=i},b=async()=>{var i;if((i=o.user)!=null&&i.id)try{const s=await J(o.user.id);r.value=s;const _=await Q(o.user.id);c.value=_;const p=await U(o.user.id);u.value=p}catch(s){console.error("加载仪表盘数据失败:",s)}};return B(()=>{b()}),(i,s)=>{const _=C("el-icon"),p=C("el-card"),k=C("el-button"),S=C("el-tag");return y(),j("div",G,[t("div",H,[t("div",K,[s[4]||(s[4]=t("h2",null,"欢迎回来！",-1)),t("p",null,"今天是 "+l(m.value)+"，让我们开始高效的工作吧",1)]),t("div",W,[e(p,{class:"stat-card"},{default:a(()=>[t("div",X,[t("div",Y,[e(_,{color:"#409eff"},{default:a(()=>[e(g(R))]),_:1})]),t("div",Z,[t("div",tt,l(r.value.organizations),1),s[5]||(s[5]=t("div",{class:"stat-label"},"组织数量",-1))])])]),_:1}),e(p,{class:"stat-card"},{default:a(()=>[t("div",st,[t("div",et,[e(_,{color:"#67c23a"},{default:a(()=>[e(g($))]),_:1})]),t("div",at,[t("div",ot,l(r.value.projects),1),s[6]||(s[6]=t("div",{class:"stat-label"},"项目数量",-1))])])]),_:1}),e(p,{class:"stat-card"},{default:a(()=>[t("div",nt,[t("div",rt,[e(_,{color:"#e6a23c"},{default:a(()=>[e(g(V))]),_:1})]),t("div",it,[t("div",lt,l(r.value.tasks),1),s[7]||(s[7]=t("div",{class:"stat-label"},"待办任务",-1))])])]),_:1}),e(p,{class:"stat-card"},{default:a(()=>[t("div",dt,[t("div",ct,[e(_,{color:"#f56c6c"},{default:a(()=>[e(g(L))]),_:1})]),t("div",ut,[t("div",_t,l(r.value.documents),1),s[8]||(s[8]=t("div",{class:"stat-label"},"知识文档",-1))])])]),_:1})]),t("div",pt,[e(p,{class:"recent-projects"},{header:a(()=>[t("div",ft,[s[10]||(s[10]=t("span",null,"最近项目",-1)),e(k,{type:"primary",size:"small",onClick:s[0]||(s[0]=d=>i.$router.push("/organizations"))},{default:a(()=>[...s[9]||(s[9]=[h(" 查看全部 ",-1)])]),_:1})])]),default:a(()=>[c.value.length===0?(y(),j("div",vt,[e(_,null,{default:a(()=>[e(g($))]),_:1}),s[12]||(s[12]=t("p",null,"暂无项目",-1)),e(k,{type:"primary",onClick:s[1]||(s[1]=d=>i.$router.push("/organizations"))},{default:a(()=>[...s[11]||(s[11]=[h(" 创建项目 ",-1)])]),_:1})])):(y(),j("div",mt,[(y(!0),j(N,null,P(c.value,d=>(y(),j("div",{key:d.id,class:"project-item",onClick:$t=>z(d)},[t("div",yt,[t("h4",null,l(d.name),1),t("p",null,l(d.description),1)]),t("div",ht,[e(S,{type:f(d.status)},{default:a(()=>[h(l(d.status),1)]),_:2},1032,["type"])])],8,gt))),128))]))]),_:1}),e(p,{class:"ai-assistant"},{header:a(()=>[...s[13]||(s[13]=[t("div",{class:"card-header"},[t("span",null,"AI 助手")],-1)])]),default:a(()=>[t("div",wt,[t("div",bt,[e(_,null,{default:a(()=>[e(g(M))]),_:1})]),s[14]||(s[14]=t("div",{class:"ai-message"},[t("p",null,"您好！我是您的AI项目管理助手。有什么可以帮助您的吗？")],-1))]),e(k,{type:"primary",style:{width:"100%","margin-top":"16px"}},{default:a(()=>[...s[15]||(s[15]=[h(" 开始对话 ",-1)])]),_:1})]),_:1}),n.value?(y(),E(p,{key:0,class:"project-detail-panel"},{header:a(()=>[t("div",kt,[s[16]||(s[16]=t("span",null,"项目详情",-1)),e(k,{type:"text",onClick:s[2]||(s[2]=d=>n.value=null)},{default:a(()=>[e(_,null,{default:a(()=>[e(g(O))]),_:1})]),_:1})])]),default:a(()=>[t("div",jt,[t("h3",null,l(n.value.name),1),t("p",zt,l(n.value.description),1),t("div",Dt,[e(S,{type:f(n.value.status)},{default:a(()=>[h(l(n.value.status),1)]),_:1},8,["type"]),t("span",Ct,"创建时间: "+l(n.value.created_at),1)]),e(k,{type:"primary",onClick:s[3]||(s[3]=d=>i.$router.push(`/projects/${n.value.id}`)),style:{"margin-top":"16px"}},{default:a(()=>[...s[17]||(s[17]=[h(" 查看完整详情 ",-1)])]),_:1})])]),_:1})):x("",!0)])])])}}}),Nt=F(St,[["__scopeId","data-v-ccbf6d40"]]);export{Nt as default};
